<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaderboard — Single File App</title>
  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            display: ['ui-sans-serif', 'system-ui', 'Inter', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial'],
          },
        }
      }
    }
  </script>
  <style>
    /* -----------------------------
       Animated Wave Background (as requested)
       ----------------------------- */
    * { margin: 0; padding: 0; }
    section {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #3586ff;
      overflow: hidden;
    }
    section .air{
      position: absolute;
      bottom: 0; left: 0;
      width: 100%; height: 100px;
      background: url(https://1.bp.blogspot.com/-xQUc-TovqDk/XdxogmMqIRI/AAAAAAAACvI/AizpnE509UMGBcTiLJ58BC6iViPYGYQfQCLcBGAsYHQ/s1600/wave.png);
      background-size: 1000px 100px
    }
    section .air.air1{ animation: wave 30s linear infinite; z-index: 1000; opacity: 1; animation-delay: 0s; bottom: 0; }
    section .air.air2{ animation: wave2 15s linear infinite; z-index: 999; opacity: 0.5; animation-delay: -5s; bottom: 10px; }
    section .air.air3{ animation: wave 30s linear infinite; z-index: 998; opacity: 0.2; animation-delay: -2s; bottom: 15px; }
    section .air.air4{ animation: wave2 5s linear infinite; z-index: 997; opacity: 0.7; animation-delay: -5s; bottom: 20px; }
    @keyframes wave{ 0%{ background-position-x: 0px; } 100%{ background-position-x: 1000px; } }
    @keyframes wave2{ 0%{ background-position-x: 0px; } 100%{ background-position-x: -1000px; } }

    /* -----------------------------
       Fireworks (CSS pyro) — SCSS rewritten to plain CSS
       ----------------------------- */
    .pyro { position: absolute; inset: 0; pointer-events: none; }
    .pyro > .before, .pyro > .after {
      position: absolute;
      top: 0; left: 0;
      width: 4px; height: 4px;
      border-radius: 50%;
      box-shadow: 0 0 #fff; /* will be animated into multi-point explosion */
      animation: bang 1s ease-out infinite backwards,
                 gravity 1.1s ease-in infinite backwards,
                 position 6s linear infinite backwards;
      content: "";
    }
    .pyro > .after { animation-delay: 1.25s, 1.25s, 1.25s; animation-duration: 1.25s, 1.25s, 6.25s; }

    /* The bang anim switches the box-shadow to many colored particles */
    @keyframes bang {
      to {
        /* 60-ish particles with varied positions and hues */
        box-shadow:
          0 -120px hsl(0,100%,60%),
          40px -110px hsl(30,100%,60%),
          -40px -100px hsl(60,100%,60%),
          80px -90px hsl(90,100%,60%),
          -80px -80px hsl(120,100%,60%),
          110px -60px hsl(150,100%,60%),
          -110px -50px hsl(180,100%,60%),
          120px -20px hsl(210,100%,60%),
          -120px -10px hsl(240,100%,60%),
          125px 20px hsl(270,100%,60%),
          -125px 30px hsl(300,100%,60%),
          110px 60px hsl(330,100%,60%),
          -110px 70px hsl(15,100%,60%),
          90px 90px hsl(45,100%,60%),
          -90px 100px hsl(75,100%,60%),
          60px 115px hsl(105,100%,60%),
          -60px 120px hsl(135,100%,60%),
          30px 125px hsl(165,100%,60%),
          -30px 125px hsl(195,100%,60%),
          0 130px hsl(225,100%,60%),
          20px -130px hsl(255,100%,60%),
          -20px -130px hsl(285,100%,60%),
          55px -123px hsl(315,100%,60%),
          -55px -118px hsl(345,100%,60%),
          100px -100px hsl(180,100%,60%),
          -100px -100px hsl(60,100%,60%),
          130px 0 hsl(0,100%,60%),
          -130px 0 hsl(120,100%,60%),
          95px 105px hsl(200,100%,60%),
          -95px 105px hsl(300,100%,60%),
          70px 115px hsl(40,100%,60%),
          -70px 115px hsl(80,100%,60%),
          40px 120px hsl(160,100%,60%),
          -40px 120px hsl(220,100%,60%),
          10px 125px hsl(280,100%,60%),
          -10px 125px hsl(320,100%,60%),
          120px 40px hsl(20,100%,60%),
          -120px 40px hsl(200,100%,60%),
          115px -30px hsl(260,100%,60%),
          -115px -30px hsl(20,100%,60%),
          60px -125px hsl(90,100%,60%),
          -60px -125px hsl(330,100%,60%),
          0 -140px hsl(180,100%,60%),
          140px 0 hsl(240,100%,60%),
          -140px 0 hsl(300,100%,60%),
          100px 100px hsl(120,100%,60%),
          -100px 100px hsl(0,100%,60%),
          130px -70px hsl(60,100%,60%),
          -130px -70px hsl(180,100%,60%),
          85px -115px hsl(240,100%,60%),
          -85px -115px hsl(300,100%,60%),
          45px -125px hsl(20,100%,60%),
          -45px -125px hsl(80,100%,60%),
          0 0 #fff;
      }
    }
    @keyframes gravity { to { transform: translateY(220px); opacity: 0; } }
    @keyframes position {
      0%, 19.9% { margin-top: 10%; margin-left: 40%; }
      20%, 39.9% { margin-top: 40%; margin-left: 30%; }
      40%, 59.9% { margin-top: 20%; margin-left: 70% }
      60%, 79.9% { margin-top: 30%; margin-left: 20%; }
      80%, 99.9% { margin-top: 30%; margin-left: 80%; }
    }
  </style>
</head>
<body class="font-display text-slate-800 dark:text-slate-100 bg-transparent min-h-screen selection:bg-indigo-200/60 dark:selection:bg-indigo-400/40">
  <!-- Theme Toggle (always visible) -->
  <button id="themeToggle" class="fixed right-4 top-4 z-40 inline-flex items-center gap-2 rounded-full border border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-800/80 backdrop-blur px-4 py-2 text-sm shadow hover:shadow-md transition">
    <span id="themeIcon" aria-hidden="true">🌙</span>
    <span class="hidden sm:inline">Toggle Theme</span>
  </button>

  <!-- App Container -->
  <main id="app" class="container mx-auto px-4 py-10 md:py-16">
    <!-- Screen: Setup -->
    <div id="setupScreen" class="max-w-4xl mx-auto min-h-max flex items-center justify-center">
      <div class="w-full rounded-3xl border border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-900/70 backdrop-blur shadow-xl">
        <div class="p-6 md:p-10">
          <h1 class="text-3xl md:text-4xl font-bold tracking-tight mb-6">Create Your Leaderboard</h1>
          <p class="text-slate-700 dark:text-slate-300 mb-8">Name your board, list teams and participants, then shuffle (optional) and start!</p>

          <div class="grid md:grid-cols-2 gap-6">
            <label class="flex flex-col gap-2">
              <span class="text-sm font-semibold">Leaderboard Name</span>
              <input id="lbName" type="text" placeholder="e.g., Friday Game Night" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500" />
            </label>
            <label class="flex flex-col gap-2">
              <span class="text-sm font-semibold">Team Names (one per line)</span>
              <textarea id="teamNames" class="h-32 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Team Alpha\nTeam Beta\nTeam Gamma"></textarea>
            </label>
            <label class="md:col-span-2 flex flex-col gap-2">
              <span class="text-sm font-semibold">Participants (one per line)</span>
              <textarea id="participants" class="h-40 w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Alice\nBob\nCharlie\nDana\nEve\nFrank"></textarea>
            </label>
          </div>

          <div class="mt-8 flex flex-wrap items-center gap-3">
            <button id="shuffleBtn" class="rounded-xl bg-indigo-600 text-white px-5 py-3 font-medium shadow hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300">Shuffle Players</button>
            <button id="startBtn" class="rounded-xl bg-emerald-600 text-white px-5 py-3 font-medium shadow hover:bg-emerald-700 focus:outline-none focus:ring-4 focus:ring-emerald-300">Start Game</button>
            <span id="shuffleStatus" class="text-sm text-slate-600"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Screen: Leaderboard (centered) -->
    <div id="leaderboardScreen" class="hidden min-h-max flex items-center justify-center">
      <div class="w-full max-w-7xl">
        <div class="flex items-center justify-end mb-6">
            <button id="endGameBtn" class="rounded-xl bg-rose-600 text-white px-5 py-3 font-medium shadow hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-300">End Game</button>
        </div>
        <div class="flex items-center justify-center mb-6 mt-6">
            <h2 id="boardTitle" class="text-3xl md:text-4xl font-extrabold tracking-tight"></h2>
        </div>
        <div id="teamsContainer" class="grid gap-6 md:gap-8 w-full" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));"></div>
      </div>
    </div>

    <!-- Screen: End (centered) -->
    <div id="endScreen" class="hidden min-h-max flex flex-col items-center justify-center">
      <div class="relative w-full max-w-5xl rounded-3xl border border-slate-200 dark:border-slate-700 bg-white/85 dark:bg-slate-900/70 backdrop-blur shadow-xl p-6 md:p-10 overflow-hidden">
        <h3 id="winnerHeading" class="text-3xl md:text-4xl font-black text-center mb-8"></h3>

        <!-- Podium -->
        <div class="max-w-3xl mx-auto">
          <h4 class="text-center text-xl font-semibold mb-6">Top 3 Players</h4>
          <!-- Simple, static podium (no animations) -->
          <div class="grid grid-cols-3 items-end gap-4 text-center">
            <!-- 2nd place (left) -->
            <div id="podium-2" class="flex flex-col items-center">
              <div class="w-full h-40 bg-slate-400/90 dark:bg-slate-600 rounded-t-xl flex flex-col items-center justify-center p-2">
                <span data-name class="font-semibold"></span>
                <span data-score class="text-sm"></span>
              </div>
              <span class="mt-2 text-slate-600 dark:text-slate-300">2nd</span>
            </div>
            <!-- 1st place (center) -->
            <div id="podium-1" class="flex flex-col items-center">
              <div class="w-full h-56 bg-yellow-400/90 dark:bg-yellow-600 rounded-t-xl flex flex-col items-center justify-center p-2">
                <span data-name class="font-bold"></span>
                <span data-score class="text-sm"></span>
              </div>
              <span class="mt-2 text-yellow-700 dark:text-yellow-300">1st</span>
            </div>
            <!-- 3rd place (right) -->
            <div id="podium-3" class="flex flex-col items-center">
              <div class="w-full h-32 bg-orange-400/90 dark:bg-orange-600 rounded-t-xl flex flex-col items-center justify-center p-2">
                <span data-name class="font-medium"></span>
                <span data-score class="text-sm"></span>
              </div>
              <span class="mt-2 text-amber-700/90">3rd</span>
            </div>
          </div>
        </div>

        <!-- Fireworks Layer -->
        <div class="pyro hidden"><div class="before"></div><div class="after"></div></div>
      </div>

      <div class="mt-8 flex justify-center">
        <button id="restartBtn" class="rounded-xl bg-indigo-600 text-white px-5 py-3 font-medium shadow hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300">Start Over</button>
      </div>
    </div>
  </main>

  <!-- Fixed background waves behind content -->
  <section class="fixed inset-0 -z-10">
    <div class="air air1"></div>
    <div class="air air2"></div>
    <div class="air air3"></div>
    <div class="air air4"></div>
  </section>

  <script>
    // ------------------------------
    // Simple App State
    // ------------------------------
    const state = {
      leaderboardName: '',
      teams: [], // [{ name, players: [{name, score}], total }]
      shuffled: false,
    };

    // Utility: Trim, split lines, remove empties, dedupe while keeping order
    function parseLines(str) {
      return Array.from(new Set((str || '').split(/\r?\n/).map(s => s.trim()).filter(Boolean)));
    }

    // Utility: Calculate team totals and keep alphabetical sorting of players
    function recalcTotals() {
      state.teams.forEach(t => {
        t.players.sort((a, b) => a.name.localeCompare(b.name));
        t.total = t.players.reduce((sum, p) => sum + (Number(p.score) || 0), 0);
      });
    }

    // ------------------------------
    // Setup Screen Logic
    // ------------------------------
    const lbNameInput = document.getElementById('lbName');
    const teamNamesInput = document.getElementById('teamNames');
    const participantsInput = document.getElementById('participants');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const startBtn = document.getElementById('startBtn');
    const shuffleStatus = document.getElementById('shuffleStatus');

    shuffleBtn.addEventListener('click', () => {
      const teams = parseLines(teamNamesInput.value);
      const players = parseLines(participantsInput.value);
      if (teams.length === 0 || players.length === 0) {
        alert('Please enter at least one team and one participant before shuffling.');
        return;
      }
      // Prepare state. Shuffle participants then distribute round-robin.
      state.leaderboardName = lbNameInput.value.trim() || 'My Leaderboard';
      state.teams = teams.map(name => ({ name, players: [], total: 0 }));

      const shuffled = [...players];
      // Fisher-Yates shuffle
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      // Distribute as equally as possible
      shuffled.forEach((name, idx) => {
        const teamIndex = idx % state.teams.length;
        state.teams[teamIndex].players.push({ name, score: 0 });
      });
      state.shuffled = true;
      recalcTotals();
      shuffleStatus.textContent = '✅ Players shuffled into teams!';
    });

    startBtn.addEventListener('click', () => {
      const teams = parseLines(teamNamesInput.value);
      const players = parseLines(participantsInput.value);
      if (teams.length === 0 || players.length === 0) {
        alert('Please enter at least one team and one participant.');
        return;
      }

      state.leaderboardName = lbNameInput.value.trim() || 'My Leaderboard';

      if (!state.shuffled) {
        // Assign all to first team
        state.teams = teams.map((name, i) => ({ name, players: i === 0 ? players.map(p => ({ name: p, score: 0 })) : [], total: 0 }));
        recalcTotals();
      } else {
        // If user changed inputs after shuffle, ensure team names match current inputs
        const currentNames = state.teams.map(t => t.name);
        if (JSON.stringify(currentNames) !== JSON.stringify(teams)) {
          // Rebuild keeping members grouped by new order (put all players into first if mismatch)
          state.teams = teams.map((name, i) => ({ name, players: i === 0 ? state.teams.flatMap(t => t.players) : [], total: 0 }));
          recalcTotals();
        }
      }

      renderLeaderboard();
      showScreen('leaderboard');
    });

    // ------------------------------
    // Leaderboard Rendering & Interactions
    // ------------------------------
    const boardTitle = document.getElementById('boardTitle');
    const teamsContainer = document.getElementById('teamsContainer');
    const endGameBtn = document.getElementById('endGameBtn');

    function renderLeaderboard() {
      recalcTotals();
      boardTitle.textContent = state.leaderboardName;
      teamsContainer.innerHTML = '';

      state.teams.forEach((team, teamIdx) => {
        const card = document.createElement('div');
        card.className = 'rounded-2xl border border-slate-200 dark:border-slate-700 bg-white/80 dark:bg-slate-900/60 backdrop-blur shadow p-4 flex flex-col';

        // Header
        const header = document.createElement('div');
        header.className = 'flex items-center justify-between mb-3';
        header.innerHTML = `
          <div>
            <h3 class="font-bold text-lg">${escapeHtml(team.name)}</h3>
            <p class="text-sm text-slate-500">${team.players.length} player${team.players.length!==1?'s':''}</p>
          </div>
          <div class="text-right">
            <span class="text-xs uppercase text-slate-500">Team Total</span>
            <div class="text-2xl font-extrabold">${team.total}</div>
          </div>
        `;
        card.appendChild(header);

        // Player list
        const list = document.createElement('div');
        list.className = 'space-y-2 grow';

        team.players.forEach((player, pIdx) => {
          const row = document.createElement('div');
          row.className = 'grid grid-cols-[1fr,auto,auto,auto] items-center gap-2 rounded-xl bg-slate-50/80 dark:bg-slate-900/40 border border-slate-200 dark:border-slate-700 px-3 py-2';

          const name = document.createElement('div');
          name.className = 'font-medium truncate';
          name.textContent = player.name;

          const score = document.createElement('div');
          score.className = 'tabular-nums font-bold text-center min-w-[2ch]';
          score.textContent = player.score;

          // Score controls
          const scoreControls = document.createElement('div');
          scoreControls.className = 'flex items-center gap-1';
          scoreControls.innerHTML = `
            <button class="px-2 py-1 rounded-lg bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600" title="Decrease">−</button>
            <button class="px-2 py-1 rounded-lg bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600" title="Increase">+</button>
          `;
          const [decBtn, incBtn] = scoreControls.querySelectorAll('button');
          incBtn.addEventListener('click', () => changeScore(teamIdx, player.name, +1));
          decBtn.addEventListener('click', () => changeScore(teamIdx, player.name, -1));

          // Move controls
          const moveControls = document.createElement('div');
          moveControls.className = 'flex items-center gap-1';
          moveControls.innerHTML = `
            <button class="px-2 py-1 rounded-lg bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-900" title="Move Left">◀</button>
            <button class="px-2 py-1 rounded-lg bg-indigo-100 dark:bg-indigo-900/40 text-indigo-700 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-indigo-900" title="Move Right">▶</button>
          `;
          const [leftBtn, rightBtn] = moveControls.querySelectorAll('button');
          leftBtn.addEventListener('click', () => movePlayer(teamIdx, player.name, -1));
          rightBtn.addEventListener('click', () => movePlayer(teamIdx, player.name, +1));

          row.appendChild(name);
          row.appendChild(score);
          row.appendChild(scoreControls);
          row.appendChild(moveControls);
          list.appendChild(row);
        });

        card.appendChild(list);

        // Footer (Add player)
        const footer = document.createElement('div');
        footer.className = 'mt-4 pt-3 border-t border-slate-200 dark:border-slate-700';
        const addBtn = document.createElement('button');
        addBtn.className = 'w-full rounded-xl bg-emerald-600 text-white px-4 py-2 font-medium hover:bg-emerald-700';
        addBtn.textContent = 'Add Player';
        addBtn.addEventListener('click', () => {
          const name = prompt(`Enter new player name for \"${team.name}\":`);
          if (!name) return;
          team.players.push({ name: name.trim(), score: 0 });
          renderLeaderboard();
        });
        footer.appendChild(addBtn);
        card.appendChild(footer);

        teamsContainer.appendChild(card);
      });
    }

    function changeScore(teamIdx, playerName, delta) {
      const team = state.teams[teamIdx];
      const p = team.players.find(pl => pl.name === playerName);
      if (!p) return;
      p.score = (p.score || 0) + delta;
      renderLeaderboard(); // re-render to update team totals and sorted order
    }

    function movePlayer(fromTeamIdx, playerName, direction) {
      const team = state.teams[fromTeamIdx];
      const idx = team.players.findIndex(pl => pl.name === playerName);
      if (idx === -1) return;
      const [player] = team.players.splice(idx, 1);
      const toTeamIdx = (fromTeamIdx + direction + state.teams.length) % state.teams.length;
      state.teams[toTeamIdx].players.push(player);
      renderLeaderboard();
    }

    endGameBtn.addEventListener('click', () => {
      renderEndScreen();
      showScreen('end');
    });

    // ------------------------------
    // End Screen Rendering
    // ------------------------------
    const winnerHeading = document.getElementById('winnerHeading');
    const restartBtn = document.getElementById('restartBtn');

    function renderEndScreen() {
      recalcTotals();
      // Determine winning team (highest total). If tie, first encountered wins.
      let winner = state.teams[0];
      for (const t of state.teams) if (t.total > winner.total) winner = t;
      winnerHeading.textContent = `🏆 Winning Team: ${winner ? winner.name : '—'} (Total: ${winner ? winner.total : 0})`;

      // Top 3 players across all teams
      const allPlayers = state.teams.flatMap(t => t.players.map(p => ({ ...p })));
      allPlayers.sort((a, b) => b.score - a.score || a.name.localeCompare(b.name));
      const top3 = [allPlayers[0], allPlayers[1], allPlayers[2]].map(p => p || { name: '—', score: 0 });

      setPodium('1', top3[0]);
      setPodium('2', top3[1]);
      setPodium('3', top3[2]);

      // Show fireworks (CSS only)
      document.querySelector('.pyro').classList.remove('hidden');
    }

    function setPodium(place, player) {
      const pod = document.getElementById(`podium-${place}`);
      pod.querySelector('[data-name]').textContent = player?.name ?? '—';
      pod.querySelector('[data-score]').textContent = `Score: ${player?.score ?? 0}`;
    }

    restartBtn.addEventListener('click', () => {
      // Reset state and UI
      state.leaderboardName = '';
      state.teams = [];
      state.shuffled = false;
      lbNameInput.value = '';
      teamNamesInput.value = '';
      participantsInput.value = '';
      shuffleStatus.textContent = '';
      // Hide fireworks
      const pyro = document.querySelector('.pyro');
      if (pyro) pyro.classList.add('hidden');
      showScreen('setup');
    });

    // ------------------------------
    // Screen Router
    // ------------------------------
    function showScreen(name) {
      document.getElementById('setupScreen').classList.toggle('hidden', name !== 'setup');
      document.getElementById('leaderboardScreen').classList.toggle('hidden', name !== 'leaderboard');
      document.getElementById('endScreen').classList.toggle('hidden', name !== 'end');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ------------------------------
    // Theme Toggle
    // ------------------------------
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');

    function applyTheme(theme) {
      const html = document.documentElement;
      const isDark = theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
      html.classList.toggle('dark', isDark);
      themeIcon.textContent = isDark ? '☀️' : '🌙';
    }

    function getStoredTheme() { return localStorage.getItem('leaderboard-theme') || 'system'; }
    function setStoredTheme(t) { localStorage.setItem('leaderboard-theme', t); }

    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      applyTheme(next); setStoredTheme(next);
    });

    // Apply theme on load
    applyTheme(getStoredTheme());

    // ------------------------------
    // Helpers
    // ------------------------------
    function escapeHtml(str) {
      return (str || '').replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));
    }

    // Load with setup screen visible
    showScreen('setup');
  </script>
</body>
</html>
